<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Audio + Visual Drift | Chiwansam</title>
  <meta name="description" content="Èü≥Ê•Ω„Å´Âêà„Çè„Åõ„Å¶Èùô„Åã„Å´ÂÜôÁúü„ÅåÂ∑°„Çã„ÄÅÊ≤°ÂÖ•Âûã„Çπ„É©„Ç§„Éâ„Ç∑„Éß„Éº" />
  <style>
    :root{
      --bg:#0f0f12; --ink:#eaeaf0; --muted:#a7a7b3; --accent:#b8a7ff; --line:#2a2a31;
      --maxw:1280px; --pad:16px;
    }
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP","Yu Gothic","Meiryo",sans-serif;overflow:hidden}

    .stage{position:relative;height:100vh;width:100vw;overflow:hidden}
    .slide{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity 1.8s ease}
    .slide img{width:100%;height:100%;object-fit:cover;filter:contrast(1.02) saturate(1.02)}
    .slide.active{opacity:1}
    .slide.active img{animation:ken 18s ease-in-out forwards}
    @keyframes ken{0%{transform:scale(1.03)}100%{transform:scale(1.08)}}

    /* Start „Éú„Çø„É≥„ÇíÁîªÂÉè‰∏ä„Å´Èáç„Å≠„Çã */
    #gate{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:14px;background:rgba(0,0,0,.3);z-index:5}
    #gate.hidden{opacity:0;pointer-events:none;transition:opacity .8s ease}
    .start{appearance:none;border:1px solid var(--line);background:rgba(0,0,0,.5);color:var(--ink);padding:10px 20px;border-radius:10px;font-size:18px;cursor:pointer}
    .start:hover{background:rgba(0,0,0,.7)}
    .muted{color:var(--muted)}

    .overlay{position:absolute;left:0;right:0;bottom:0;padding:18px var(--pad);background:linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,.5) 65%, rgba(0,0,0,.65) 100%);}
    .meta{max-width:var(--maxw);margin:0 auto;display:flex;align-items:center;gap:12px;flex-wrap:wrap}
    .title{font-weight:700}

    .controls{display:flex;align-items:center;gap:10px;margin-left:auto}
    .btn{appearance:none;border:1px solid var(--line);background:#17171b;color:var(--ink);padding:8px 10px;border-radius:10px;cursor:pointer}
    .btn:hover{border-color:#3a3a44}

    .progress{position:relative;flex:1;min-width:220px;height:6px;background:#1e1e25;border-radius:999px;overflow:hidden}
    .bar{position:absolute;left:0;top:0;bottom:0;width:0;background:var(--accent)}

    .dock{position:absolute;left:0;right:0;bottom:0;max-width:var(--maxw);margin:0 auto;padding:10px var(--pad);display:flex;align-items:center;gap:12px;border-top:1px solid var(--line);backdrop-filter:blur(8px);background:rgba(0,0,0,.3)}
    .vol{display:flex;align-items:center;gap:8px}
    input[type=range]{accent-color:var(--accent)}
  </style>
</head>
<body>
  <section class="stage" aria-live="polite" aria-label="„Çπ„É©„Ç§„Éâ„Ç∑„Éß„Éº">
    <div class="slide" id="s0"><img alt="" /></div>
    <div class="slide" id="s1"><img alt="" /></div>
    <div id="gate">
      <button id="start" class="start">‚ñ∂ Start</button>
      <div class="muted" style="font-size:13px">ÈñãÂßã„Åô„Çã„Å®Èü≥Ê•Ω„Å®„Çπ„É©„Ç§„Éâ„ÅåÊµÅ„Çå„Åæ„Åô</div>
    </div>
    <div class="overlay">
      <div class="meta">
        <div class="title" id="trackTitle">‚Äî</div>
        <div class="muted" id="now">Now Playing</div>
        <div class="controls">
          <button id="prev" class="btn">‚ü®‚ü®</button>
          <button id="play" class="btn">‚è∏</button>
          <button id="next" class="btn">‚ü©‚ü©</button>
        </div>
      </div>
    </div>
  </section>
  <div class="dock">
    <div class="progress" aria-label="ÈÄ≤Ë°åÁä∂Ê≥Å"><div class="bar" id="prog"></div></div>
    <div class="time muted" id="time">0:00 / 0:00</div>
    <div class="vol">
      <button id="mute" class="btn">üîà</button>
      <input id="volume" type="range" min="0" max="1" step="0.01" value="0.85">
    </div>
  </div>
  <audio id="audio" preload="auto" hidden></audio>

  <script>
  const DATA_URL = '/assets/av.json';
  const FALLBACK = { playlist:[ { title:'Sample Track', music:'https://cdn.pixabay.com/download/audio/2021/09/16/audio_1.mp3?filename=sample-3s.mp3', images:[ 'https://picsum.photos/seed/av1/1600/900', 'https://picsum.photos/seed/av2/1600/900', 'https://picsum.photos/seed/av3/1600/900' ], interval: 4000 } ] };

  const el={stage:document.querySelector('.stage'),slides:[document.getElementById('s0'),document.getElementById('s1')],img0:document.querySelector('#s0 img'),img1:document.querySelector('#s1 img'),gate:document.getElementById('gate'),start:document.getElementById('start'),title:document.getElementById('trackTitle'),btnPrev:document.getElementById('prev'),btnPlay:document.getElementById('play'),btnNext:document.getElementById('next'),prog:document.getElementById('prog'),time:document.getElementById('time'),volume:document.getElementById('volume'),mute:document.getElementById('mute'),audio:document.getElementById('audio')};

  let data=FALLBACK,idxTrack=0,idxImg=0,timer=null,showing=0;

  function preload(u){u.forEach(x=>{const i=new Image();i.src=x;});}
  function hms(s){if(!isFinite(s))return'0:00';const m=Math.floor(s/60),sec=Math.floor(s%60);return`${m}:${String(sec).padStart(2,'0')}`;}
  function setProgress(){const a=el.audio,p=(a.currentTime/(a.duration||1))*100;el.prog.style.width=p+'%';el.time.textContent=`${hms(a.currentTime)} / ${hms(a.duration)}`;}
  function swapSlide(nextUrl){const next=(showing^1);const img=el.slides[next].querySelector('img');img.src=nextUrl;el.slides[next].classList.add('active');el.slides[showing].classList.remove('active');showing=next;}
  function startSlideshow(track){clearInterval(timer);const images=track.images||[];if(!images.length)return;idxImg=0;showing=0;el.img0.src=images[0];el.slides[0].classList.add('active');el.slides[1].classList.remove('active');preload(images);timer=setInterval(()=>{idxImg=(idxImg+1)%images.length;swapSlide(images[idxImg]);},Math.max(2500,track.interval||5000));}
  function loadTrack(i){const list=data.playlist||[data];idxTrack=(i+list.length)%list.length;const t=list[idxTrack];el.title.textContent=t.title||'Untitled';el.audio.src=t.music;el.audio.play().catch(()=>{});startSlideshow(t);}

  el.audio.addEventListener('timeupdate',setProgress);
  el.audio.addEventListener('ended',()=>loadTrack(idxTrack+1));
  el.btnPrev.addEventListener('click',()=>loadTrack(idxTrack-1));
  el.btnNext.addEventListener('click',()=>loadTrack(idxTrack+1));
  el.btnPlay.addEventListener('click',()=>{if(el.audio.paused){el.audio.play();el.btnPlay.textContent='‚è∏';}else{el.audio.pause();el.btnPlay.textContent='‚ñ∂';}});
  el.volume.addEventListener('input',()=>{el.audio.volume=parseFloat(el.volume.value);});
  el.mute.addEventListener('click',()=>{el.audio.muted=!el.audio.muted;el.mute.textContent=el.audio.muted?'üîá':'üîà';});
  document.querySelector('.progress').addEventListener('click',e=>{const r=e.currentTarget.getBoundingClientRect();const ratio=(e.clientX-r.left)/r.width;el.audio.currentTime=ratio*(el.audio.duration||0);});

  el.start.addEventListener('click',async()=>{el.gate.classList.add('hidden');try{const r=await fetch(DATA_URL,{cache:'no-cache'});data=r.ok?await r.json():FALLBACK;}catch{data=FALLBACK;}loadTrack(0);});

  window.addEventListener('keydown',e=>{if(e.key===' '){e.preventDefault();el.btnPlay.click();}else if(e.key==='ArrowRight'){el.btnNext.click();}else if(e.key==='ArrowLeft'){el.btnPrev.click();}});
  </script>
</body>
</html>
