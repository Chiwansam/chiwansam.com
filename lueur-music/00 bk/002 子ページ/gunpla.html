<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gunpla | Chiwansam</title>
  <meta name="description" content="ガンプラ（Gundam Artifact中心）の静かなギャラリー" />
  <style>
    :root{
      --bg:#ffffff; --ink:#111; --muted:#666; --line:#e9e9e9; --accent:#9b87f5;
      --card-radius:18px; --gap:24px; --maxw:1280px;
    }
    body{margin:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP","Yu Gothic","Meiryo",sans-serif; color:var(--ink); background:var(--bg); line-height:1.6}

    header{position:sticky; top:0; background:linear-gradient(180deg,rgba(255,255,255,.9),rgba(255,255,255,.75)); backdrop-filter:blur(6px); border-bottom:1px solid var(--line); z-index:10}
    .bar{max-width:var(--maxw); margin:0 auto; display:flex; align-items:center; justify-content:space-between; padding:14px 20px}
    .brand a{text-decoration:none; color:var(--ink); font-weight:700}
    nav a{color:var(--ink); text-decoration:none; opacity:.8; margin-left:14px}
    nav a:hover{opacity:1}

    .crumb{max-width:var(--maxw); margin:20px auto 0; padding:0 20px; font-size:13px; color:var(--muted)}
    .crumb a{color:inherit; text-decoration:none}

    .title{max-width:var(--maxw); margin:6px auto 0; padding:0 20px 8px}
    .title h1{margin:.2em 0 .1em; font-size:clamp(22px,3vw,30px)}
    .title p{margin:0; color:var(--muted)}

    .toolbar{max-width:var(--maxw); margin:10px auto 0; padding:0 20px 10px; display:flex; gap:10px; flex-wrap:wrap}
    .chip{border:1px solid var(--line); border-radius:999px; padding:6px 10px; font-size:13px; background:#fff; cursor:pointer}
    .chip[aria-pressed="true"]{border-color:var(--accent)}

    .grid{max-width:var(--maxw); margin:0 auto; padding:10px 20px 40px; display:grid; gap:var(--gap); grid-template-columns:repeat(12,1fr)}
    .card{grid-column:span 12; position:relative; overflow:hidden; border-radius:var(--card-radius); border:1px solid var(--line); background:#f8f8f8}
    .card-media{aspect-ratio:16/10; width:100%; object-fit:cover; display:block; background:#ddd}
    .card-body{padding:14px 16px}
    .eyebrow{font-size:12px; letter-spacing:.06em; color:var(--muted)}
    .card-title{font-weight:700; font-size:clamp(18px,2vw,22px); margin:.3em 0 .2em}
    .card-desc{font-size:14px; color:#333}
    .meta{display:flex; gap:8px; color:var(--muted); font-size:12px; margin-top:6px}
    .card a.cover{position:absolute; inset:0; text-indent:-9999px}

    .card.size-lg{grid-column:span 12}
    .card.size-md{grid-column:span 6}
    .card.size-sm{grid-column:span 4}

    @media (max-width: 1024px){.card.size-sm{grid-column:span 6}}
    @media (max-width: 640px){.card.size-md,.card.size-sm{grid-column:span 12}}

    .reveal{opacity:0; transform:translateY(10px); transition:all .6s ease}
    .reveal.show{opacity:1; transform:none}

    footer{max-width:var(--maxw); margin:10px auto 60px; padding:0 20px; font-size:13px; color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="bar">
      <div class="brand"><a href="/">Chiwansam</a></div>
      <nav><a href="/">Top</a><a href="/music/">Music</a><a href="/warhammer/">Warhammer</a></nav>
    </div>
  </header>

  <div class="crumb" aria-label="パンくず">
    <a href="/">Home</a> / ガンプラ
  </div>

  <section class="title">
    <h1>ガンプラ（Gundam Artifact）</h1>
    <p>静かな工程と仕上がりの記録。各作品へ。</p>
  </section>

  <!-- シンプルなフィルタ（タグ） -->
  <div class="toolbar" id="filters" role="toolbar" aria-label="フィルタ">
    <!-- JSON内の tags を自動収集して表示 -->
  </div>

  <main class="grid" id="grid" aria-label="作品一覧"></main>

  <footer>© <span id="year"></span> Chiwansam</footer>

  <script>
  const DATA_URL = '/assets/gunpla.json';

  // JSON 仕様：
  // [
  //   {
  //     "title": "Artifact ナイチンゲール",
  //     "description": "厚塗りを避けたキャンディレッド。",
  //     "image": "/images/gunpla/nightingale.jpg",
  //     "link": "/gunpla/nightingale.html",
  //     "size": "md",                  // lg | md | sm
  //     "tags": ["Nightingale","Red","Artifact"],
  //     "meta": {"year": 2025, "scale": "Artifact"}
  //   }
  // ]

  const FALLBACK = [
    {title:'Artifact ナイチンゲール', description:'厚塗りを避けたキャンディレッド。', image:'https://picsum.photos/seed/gunpla1/1200/800', link:'#', size:'md', tags:['Nightingale','Artifact'], meta:{year:2025}},
    {title:'Artifact ザクキャノン', description:'黒白のコントラストと金の差し色。', image:'https://picsum.photos/seed/gunpla2/1200/800', link:'#', size:'sm', tags:['Zaku Cannon','Black&White','Artifact'], meta:{year:2025}},
    {title:'Artifact ドムトローペン', description:'メタリック下地の上に温度差。', image:'https://picsum.photos/seed/gunpla3/1200/800', link:'#', size:'sm', tags:['Dom Tropen','Metallic','Artifact'], meta:{year:2024}},
    {title:'MG バルバトス', description:'写真中心の静かなアルバム。', image:'https://picsum.photos/seed/gunpla4/1200/800', link:'#', size:'md', tags:['Barbatos','MG']}
  ];

  const grid = document.getElementById('grid');
  const filters = document.getElementById('filters');
  let DATA = [];
  let active = new Set();

  function makeCard(item){
    const sizeCls = item.size === 'lg' ? 'size-lg' : item.size === 'sm' ? 'size-sm' : 'size-md';
    const el = document.createElement('article');
    el.className = `card ${sizeCls} reveal`;
    el.innerHTML = `
      <img class="card-media" alt="${escapeHtml(item.title)}" src="${item.image}">
      <div class="card-body">
        <div class="card-title">${escapeHtml(item.title)}</div>
        <div class="card-desc">${escapeHtml(item.description || '')}</div>
        ${ item.meta ? `<div class="meta">${metaToText(item.meta)}</div>` : '' }
      </div>
      <a class="cover" href="${item.link}" aria-label="${escapeHtml(item.title)} へ移動">${escapeHtml(item.title)}</a>
    `;
    return el;
  }

  function metaToText(meta){
    const kv = [];
    for(const k in meta){ kv.push(`${escapeHtml(k)}: ${escapeHtml(meta[k])}`); }
    return kv.join(' · ');
  }

  function render(list){
    grid.innerHTML = '';
    list.forEach(i=> grid.appendChild(makeCard(i)));
    reveal();
  }

  function escapeHtml(str){
    return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[s]));
  }

  function collectTags(list){
    const set = new Set();
    list.forEach(i=> (i.tags||[]).forEach(t=> set.add(t)));
    return Array.from(set).sort();
  }

  function buildFilters(tags){
    filters.innerHTML = '';
    // "All" ボタン
    const all = document.createElement('button');
    all.className = 'chip';
    all.textContent = 'All';
    all.setAttribute('aria-pressed', 'true');
    all.addEventListener('click', ()=>{ active.clear(); syncChips(); applyFilter(); });
    filters.appendChild(all);

    tags.forEach(tag=>{
      const b = document.createElement('button');
      b.className = 'chip'; b.textContent = tag; b.setAttribute('aria-pressed','false');
      b.addEventListener('click', ()=>{
        if(active.has(tag)) active.delete(tag); else active.add(tag);
        syncChips(); applyFilter();
      });
      filters.appendChild(b);
    });
  }

  function syncChips(){
    const chips = filters.querySelectorAll('.chip');
    chips.forEach(ch=>{
      const label = ch.textContent.trim();
      if(label === 'All') ch.setAttribute('aria-pressed', active.size === 0 ? 'true' : 'false');
      else ch.setAttribute('aria-pressed', active.has(label) ? 'true' : 'false');
    });
  }

  function applyFilter(){
    if(active.size === 0) return render(DATA);
    const list = DATA.filter(i=> (i.tags||[]).some(t=> active.has(t)));
    render(list);
  }

  function reveal(){
    const obs = new IntersectionObserver((entries)=>{
      for(const e of entries){ if(e.isIntersecting){ e.target.classList.add('show'); obs.unobserve(e.target); } }
    }, {threshold:.12});
    document.querySelectorAll('.reveal').forEach(el=> obs.observe(el));
  }

  fetch(DATA_URL,{cache:'no-cache'})
    .then(r=> r.ok ? r.json() : FALLBACK)
    .then(json=> { DATA = Array.isArray(json)? json : FALLBACK; buildFilters(collectTags(DATA)); applyFilter(); })
    .catch(()=> { DATA = FALLBACK; buildFilters(collectTags(DATA)); applyFilter(); });

  document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
