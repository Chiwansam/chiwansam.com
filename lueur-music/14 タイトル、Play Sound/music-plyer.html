<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lueur de Chiwan</title>
  <meta name="description" content="音と光がゆるやかに交わる静かなスライドショー" />
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:#000; --ink:#eaeaf0; --muted:#a7a7b3; --accent:#b8a7ff;
      --maxw:1280px; --pad:16px; --toph:56px; --both:88px;
    }
    html,body{height:100%;margin:0;background:#0b0b0d;color:var(--ink);font-family:'Cormorant Garamond',serif;overflow:hidden}

    /* スライド表示 */
    .stage{position:relative;height:100vh;width:100vw;overflow:hidden;background:#000}
    .slide{position:absolute;left:0;right:0;top:var(--toph);bottom:var(--both);display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity 1.0s ease}
    .slide img{width:100%;height:100%;object-fit:contain;background:#000;
    _filter:brightness(.35) contrast(1.05)}
    .slide.active{opacity:1}
    @keyframes ken{0%{transform:scale(1.00)}100%{transform:scale(1.04)}}
    body.playing .slide.active img{animation:ken 18s ease-in-out forwards}

    /* 上下黒帯 */
    .topbar{position:absolute;left:0;right:0;top:0;height:var(--toph);display:flex;align-items:center;justify-content:space-between;background:#000;padding:0 var(--pad);z-index:6;border-bottom:1px solid rgba(255,255,255,.06)}
    .topbar .title{font-weight:700;margin-left:16px; font-size:25px;}
    .topbar .brand{opacity:.9;margin-right:16px;}
    .topbar .brand a{color:var(--ink);text-decoration:none; font-size:30px;}

    .bottombar{position:absolute;left:0;right:0;bottom:0;height:var(--both);display:flex;align-items:center;gap:12px;background:#000;padding:12px var(--pad);z-index:6;border-top:1px solid rgba(255,255,255,.06)}
    .progress{flex:1;min-width:220px;height:6px;background:rgba(255,255,255,.18);border-radius:999px;overflow:hidden;cursor:pointer}
    .bar{position:absolute;left:0;top:0;bottom:0;width:0;background:var(--accent)}
    .time{min-width:92px;text-align:right;color:var(--muted);font-variant-numeric:tabular-nums}
    .vol{display:flex;align-items:center;gap:8px}
    input[type=range]{accent-color:var(--accent)}

    /* クリック領域 */
    #tap{position:absolute;left:0;right:0;top:var(--toph);bottom:var(--both);z-index:3}

    /* ─────────── Gate overlay ─────────── */
    #gate {
      position:absolute;inset:var(--toph) 0 var(--both) 0;
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      gap:100px;z-index:7;
      background:rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.25);
      padding:48px 72px;
      backdrop-filter:blur(4px);
      box-shadow:0 0 40px rgba(0,0,0,0.4);
      transition:opacity .7s ease;
    }
    #gate.hidden{opacity:0;pointer-events:none}
    .logoTitle{
      font-weight:500;letter-spacing:.05em;color:#f3f3f3;
      font-size:clamp(28px,6vw,100px);margin:0;text-align:center;
      opacity:0;transform:translateY(10px);animation:fadeUp .8s ease forwards;
      _text-shadow: 0 0 18px rgba(255,255,255,0.4);
      text-shadow:
        0 0 18px rgba(255,255,255,0.3),
        2px 4px 6px rgba(0,0,0,0.5);
    margin-top: 0.9em;
    }

    
    .logoCap{font-size:2.5rem;color:rgba(230,230,230,0.85);letter-spacing:.03em;opacity:0;transform:translateY(10px);animation:fadeUp .8s ease .4s forwards}
    @keyframes fadeUp{to{opacity:1;transform:translateY(0)}}

    audio{display:none}

    /* ここから：下バーの横一列維持とボタンスタイル */
    .bottombar{
      position:absolute; left:0; right:0; bottom:0;
      height:var(--both);
      display:flex; align-items:center;
      gap:12px;
      padding:12px var(--pad);
      background:#000; z-index:6;
      border-top:1px solid rgba(255,255,255,.06);
      box-sizing:border-box;
      flex-wrap:nowrap;           /* 折り返し禁止 */
    }
    .bottombar > *{ flex:0 0 auto; }  /* 基本は幅固定 */

    .controls{ display:flex; align-items:center; gap:10px; }
    .btn{
      appearance:none; border:1px solid rgba(255,255,255,.2);
      background:#17171b; color:var(--ink);
      padding:8px 12px; border-radius:10px; cursor:pointer;
    }
    .btn:hover{ border-color:rgba(255,255,255,.35); }

    .progress{
      position:relative;          /* 中の .bar が absolute なので必須 */
      flex:1 1 auto;              /* ここだけ伸びる */
      min-width:240px;            /* 狭すぎ対策 */
      height:6px;
      background:rgba(255,255,255,.18);
      border-radius:999px;
      overflow:hidden;
      cursor:pointer;
    }
    .bar{ position:absolute; left:0; top:0; bottom:0; width:0; background:var(--accent); }
    .time{ min-width:92px; white-space:nowrap; color:var(--muted); font-variant-numeric:tabular-nums; }
    .vol{ display:flex; align-items:center; gap:8px; }
    input[type=range]{ accent-color:var(--accent); }
    
.play {
  display: inline-flex;
  align-items: center;
  gap: 0.2em;
  font-family: 'Cormorant Garamond', serif;
  font-size: 2.2rem;
  color: #eaeaf0;
  opacity: 0.8;
  transition: opacity 0.3s;
  cursor: pointer;
}
.play span { letter-spacing: 0.05em; }
.play {
  margin-top: 1.4em; /* ←今1em程度ならこのくらいに */
}
.play:hover {
  opacity: 1;
}
.play:hover svg { stroke: #fff; } 　.play:hover span { color: #fff; opacity: 1; } 　
    
    
  </style>
</head>
<body>
  <section class="stage">
    <div class="topbar">
      <div class="title" id="trackTitle">MUSIC TITLE</div>
      <div class="brand"><a href="/">Lueur de Chiwan</a></div>
    </div>

    <div class="slide" id="s0"><img alt=""></div>
    <div class="slide" id="s1"><img alt=""></div>
    <div id="tap" aria-hidden="true"></div>

    <div id="gate">
      <h1 class="logoTitle">Lueur de Chiwan</h1>
      <!--div class="logoCap">▶ Enter Sound</div-->

<div class="play">
  <svg width="40" height="40" viewBox="0 0 14 14" fill="none" stroke="#fff" stroke-width="1.2">
    <polygon points="3,2 11,7 3,12" />
  </svg>
  <span>Enter Sound</span>
</div>

    </div>

    <div class="bottombar">
      <!-- 復活: 前/次ボタン -->
      <div class="controls">
        <button id="prev" class="btn" title="前の曲">⟨⟨</button>
        <button id="next" class="btn" title="次の曲">⟩⟩</button>
      </div>

      <div class="progress"><div class="bar" id="prog"></div></div>
      <div class="time" id="time">0:00 / 0:00</div>
      <div class="vol">
        <button id="mute" class="btn" title="ミュート切替">🔈</button>
        <input id="volume" type="range" min="0" max="1" step="0.01" value="0.85">
      </div>
    </div>
  </section>

  <audio id="audio" preload="auto"></audio>

  <script>
  const DATA_URL = '/assets/av.json';
  const FALLBACK = { playlist:[{ title:'Sample Track', music:'https://cdn.pixabay.com/download/audio/2021/09/16/audio_1.mp3?filename=sample-3s.mp3', images:['https://picsum.photos/seed/av1/1600/900'], interval:4000 }] };

  const el={
    slides:[document.getElementById('s0'),document.getElementById('s1')],
    gate:document.getElementById('gate'),
    tap:document.getElementById('tap'),
    title:document.getElementById('trackTitle'),
    prog:document.getElementById('prog'),
    time:document.getElementById('time'),
    volume:document.getElementById('volume'),
    mute:document.getElementById('mute'),
    audio:document.getElementById('audio'),
    /* 追加: 前/次ボタン */
    btnPrev:document.getElementById('prev'),
    btnNext:document.getElementById('next'),
  };

  let data=FALLBACK,idxTrack=0,idxImg=0,timer=null,showing=0,loaded=false;

  async function loadData(){
    try{
      const res=await fetch(DATA_URL+'?v='+Date.now(),{cache:'no-store'});
      if(!res.ok) throw new Error('HTTP '+res.status);
      const json=await res.json();
      if(!json||!Array.isArray(json.playlist)) throw new Error('Invalid schema');
      return json;
    }catch(err){console.error('[av.json] load error:',err);return FALLBACK;}
  }

  function preload(a){(a||[]).forEach(u=>{const i=new Image();i.src=u;});}
  function hms(s){if(!isFinite(s))return'0:00';const m=Math.floor(s/60),sec=Math.floor(s%60);return`${m}:${String(sec).padStart(2,'0')}`;}
  function setProgress(){const a=el.audio,p=(a.currentTime/(a.duration||1))*100;el.prog.style.width=p+'%';el.time.textContent=`${hms(a.currentTime)} / ${hms(a.duration)}`;}
  function swapSlide(u){const next=(showing^1);const img=el.slides[next].querySelector('img');img.src=u;el.slides[next].classList.add('active');el.slides[showing].classList.remove('active');showing=next;}
  function startSlideshow(t){clearInterval(timer);const imgs=t.images||[];if(!imgs.length)return;idxImg=0;showing=0;el.slides[0].querySelector('img').src=imgs[0];el.slides[0].classList.add('active');el.slides[1].classList.remove('active');preload(imgs);timer=setInterval(()=>{idxImg=(idxImg+1)%imgs.length;swapSlide(imgs[idxImg]);},Math.max(2500,t.interval||5000));}
  function primeFirstFrame(){const list=data.playlist||[data];const t=list[0]||{};const imgs=t.images||[];if(imgs.length){el.slides[0].querySelector('img').src=imgs[0];el.slides[0].classList.add('active');}}
  async function ensureData(){if(!loaded){data=await loadData();loaded=true;}}
  function loadTrack(i){const list=data.playlist||[data];idxTrack=(i+list.length)%list.length;const t=list[idxTrack];el.title.textContent=t.title||'—';el.audio.src=t.music;el.audio.play().catch(()=>{});startSlideshow(t);}
  function showGate(){el.gate.classList.remove('hidden');}
  function hideGate(){el.gate.classList.add('hidden');}

  el.audio.addEventListener('timeupdate',setProgress);
  el.audio.addEventListener('ended',()=>loadTrack(idxTrack+1));
  el.audio.addEventListener('pause',()=>{document.body.classList.remove('playing');showGate();});
  el.audio.addEventListener('play',()=>{document.body.classList.add('playing');hideGate();});
  el.volume.addEventListener('input',()=>{el.audio.volume=parseFloat(el.volume.value);});
  el.mute.addEventListener('click',()=>{el.audio.muted=!el.audio.muted;el.mute.textContent=el.audio.muted?'🔇':'🔈';});
  document.querySelector('.progress').addEventListener('click',e=>{const r=e.currentTarget.getBoundingClientRect();const ratio=(e.clientX-r.left)/r.width;el.audio.currentTime=ratio*(el.audio.duration||0);});

  /* 追加: 前/次ボタンの動作 */
  el.btnPrev.addEventListener('click', async ()=>{ await ensureData(); loadTrack(idxTrack-1); });
  el.btnNext.addEventListener('click', async ()=>{ await ensureData(); loadTrack(idxTrack+1); });

  el.tap.addEventListener('click',async()=>{await ensureData();if(!el.audio.src){loadTrack(0);return;}if(el.audio.paused){el.audio.play().catch(()=>{});}else{el.audio.pause();}});
  el.gate.addEventListener('click',async()=>{await ensureData();hideGate();if(!el.audio.src){loadTrack(0);}else{el.audio.play().catch(()=>{});}});

  (async function init(){data=await loadData();loaded=true;primeFirstFrame();})();
  </script>
</body>
</html>
